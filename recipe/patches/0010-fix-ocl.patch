From b5bd4237a81acba7ab5b06accc9ae74acbe876d6 Mon Sep 17 00:00:00 2001
From: bryanloz <bryanloz@xilinx.com>
Date: Sat, 2 Jul 2022 14:42:55 -0600
Subject: [PATCH 10/16] fix ocl

---
 src/include/1_2/CL/cl_ext.h                   | 41 -------------------
 src/include/1_2/CL/cl_ext_xilinx.h            |  2 +-
 src/runtime_src/xocl/CMakeLists.txt           |  1 -
 src/runtime_src/xocl/core/device.h            |  1 +
 src/runtime_src/xocl/core/memory.h            |  1 +
 tests/unit_test/002_bitonic_sort/utils.cpp    |  2 +-
 .../2kernelglobal_002_rw_4ddr_512/main.cpp    |  2 +-
 tests/unit_test/icdext/Stream.h               |  2 +-
 8 files changed, 6 insertions(+), 46 deletions(-)
 delete mode 100644 src/include/1_2/CL/cl_ext.h

diff --git a/src/include/1_2/CL/cl_ext.h b/src/include/1_2/CL/cl_ext.h
deleted file mode 100644
index 9a151442e..000000000
--- a/src/include/1_2/CL/cl_ext.h
+++ /dev/null
@@ -1,41 +0,0 @@
-/*******************************************************************************
- * Copyright (c) 2008-2015 The Khronos Group Inc.
- *
- * Permission is hereby granted, free of charge, to any person obtaining a
- * copy of this software and/or associated documentation files (the
- * "Materials"), to deal in the Materials without restriction, including
- * without limitation the rights to use, copy, modify, merge, publish,
- * distribute, sublicense, and/or sell copies of the Materials, and to
- * permit persons to whom the Materials are furnished to do so, subject to
- * the following conditions:
- *
- * The above copyright notice and this permission notice shall be included
- * in all copies or substantial portions of the Materials.
- *
- * MODIFICATIONS TO THIS FILE MAY MEAN IT NO LONGER ACCURATELY REFLECTS
- * KHRONOS STANDARDS. THE UNMODIFIED, NORMATIVE VERSIONS OF KHRONOS
- * SPECIFICATIONS AND HEADER INFORMATION ARE LOCATED AT
- *    https://www.khronos.org/registry/
- *
- * THE MATERIALS ARE PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
- * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
- * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
- * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
- * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
- * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
- * MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.
- ******************************************************************************/
-
-/*
- * Copyright (C) 2018, Xilinx Inc - All rights reserved
- */
-
-#ifndef __XOCL_CL_EXT_H
-#define __XOCL_CL_EXT_H
-
-// This isn't the coolest.  If an application truly needs cl_ext.h
-// and finds this one first, then the warning is bogus.
-//#warning Deprecated Xilinx cl_ext.h included, please replace with cl_ext_xilinx.h
-#include <CL/cl_ext_xilinx.h>
-
-#endif
diff --git a/src/include/1_2/CL/cl_ext_xilinx.h b/src/include/1_2/CL/cl_ext_xilinx.h
index 835dcaaea..244c19ea4 100644
--- a/src/include/1_2/CL/cl_ext_xilinx.h
+++ b/src/include/1_2/CL/cl_ext_xilinx.h
@@ -42,7 +42,7 @@
 
 // Do *not* include cl_ext.h from this directory
 #ifndef _WIN32
-# include_next <CL/cl_ext.h>
+# include <CL/cl_ext.h>
 #else
 # pragma warning( push )
 # pragma warning( disable : 4201 )
diff --git a/src/runtime_src/xocl/CMakeLists.txt b/src/runtime_src/xocl/CMakeLists.txt
index 341ea430f..d67cf22de 100644
--- a/src/runtime_src/xocl/CMakeLists.txt
+++ b/src/runtime_src/xocl/CMakeLists.txt
@@ -115,7 +115,6 @@ install(TARGETS xilinxopencl xilinxopencl_static
 # Release OpenCL extension headers
 install (FILES
   ${XRT_SRC_DIR}/include/1_2/CL/cl_ext_xilinx.h
-  ${XRT_SRC_DIR}/include/1_2/CL/cl_ext.h
   ${XRT_SRC_DIR}/include/1_2/CL/cl2xrt.hpp
   DESTINATION ${XRT_INSTALL_INCLUDE_DIR}/CL
   COMPONENT ${XRT_DEV_COMPONENT}
diff --git a/src/runtime_src/xocl/core/device.h b/src/runtime_src/xocl/core/device.h
index 13bd01fb6..9ca03ea8c 100644
--- a/src/runtime_src/xocl/core/device.h
+++ b/src/runtime_src/xocl/core/device.h
@@ -26,6 +26,7 @@
 #include "core/common/unistd.h"
 #include "core/common/scope_guard.h"
 
+#include <CL/cl_ext_xilinx.h>
 #include <cassert>
 
 namespace xocl {
diff --git a/src/runtime_src/xocl/core/memory.h b/src/runtime_src/xocl/core/memory.h
index 7266e0197..ddb1be3ce 100644
--- a/src/runtime_src/xocl/core/memory.h
+++ b/src/runtime_src/xocl/core/memory.h
@@ -28,6 +28,7 @@
 #include "core/common/api/bo.h"
 #include "core/include/experimental/xrt_bo.h"
 
+#include <CL/cl_ext_xilinx.h>
 #include <map>
 
 #ifdef _WIN32
diff --git a/tests/unit_test/002_bitonic_sort/utils.cpp b/tests/unit_test/002_bitonic_sort/utils.cpp
index 657b48384..f39e5a7c3 100755
--- a/tests/unit_test/002_bitonic_sort/utils.cpp
+++ b/tests/unit_test/002_bitonic_sort/utils.cpp
@@ -20,7 +20,7 @@
 #include <memory.h>
 //#include <windows.h>
 #include "CL/cl.h"
-#include "CL/cl_ext.h"
+#include "CL/cl_ext_xilinx.h"
 #include "utils.h"
 #include <assert.h>
 
diff --git a/tests/unit_test/2kernelglobal_002_rw_4ddr_512/main.cpp b/tests/unit_test/2kernelglobal_002_rw_4ddr_512/main.cpp
index b2252627f..5722a2764 100755
--- a/tests/unit_test/2kernelglobal_002_rw_4ddr_512/main.cpp
+++ b/tests/unit_test/2kernelglobal_002_rw_4ddr_512/main.cpp
@@ -22,7 +22,7 @@
 #include <cmath>
 #include <chrono>
 #include <CL/opencl.h>
-#include <CL/cl_ext.h>
+#include <CL/cl_ext_xilinx.h>
 
 //pointer access pipeline loop
 #define PIPELINELOOP                        2
diff --git a/tests/unit_test/icdext/Stream.h b/tests/unit_test/icdext/Stream.h
index 5b9b5f3c5..936dfd082 100644
--- a/tests/unit_test/icdext/Stream.h
+++ b/tests/unit_test/icdext/Stream.h
@@ -18,7 +18,7 @@
  */
 
 #include <CL/cl2.hpp>
-#include <CL/cl_ext.h>
+#include <CL/cl_ext_xilinx.h>
 
 #include <iostream>
 #include <string>
